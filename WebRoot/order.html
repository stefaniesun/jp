
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>聚派商城_地区特产网购商城</title>
<meta name="Keywords" content="聚派商城,,土特产,地方特产购物网" />
<meta name="Description" content="聚派商城,,土特产,地方特产购物网" />
<link href="misc/tc1015/css/index.css" rel="stylesheet" type="text/css" />
<link href="misc/tc1015/css/new_cart.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="misc/tc1015/js/jquery.min.js"></script>
<script type="text/javascript" src="misc/tc1015/js/cart.js"></script>
<script type="text/javascript" src="misc/tc1015/js/orderprocess.js"></script>


</head>
<body>
<style type="text/css">
.header .logo {
  width: 400px;
}
</style>

  <!--#include virtual="header.html"-->
  
 <div class="flow_step_no2 flow_cart main" style="margin-top:50px">
  <ul>
	<li class="step_1">我的购物车</li>
	<li class="step_2">填写核对订单</li>
	<li class="step_3">订单提交成功</li>
  </ul>
</div>


<div class="main margin">
  <table width="100%" border="0" cellspacing="1" cellpadding="0" bgcolor="#dcdfe4" class="cartTable">
	<tbody><tr>
      <td bgcolor="#FFFFFF">
		<div class="cartTitle asds"><strong>收货地址</strong><span><a href="address.html" target="_blank">管理收货地址</a></span></div>
        <div class="addressListBox" id="addressListBox">
          <ul id="addressList" class="clearfix">
			            <li class="newSlt" t="addAddress" style="display:none;">
              <span></span>
              <strong>添加新地址</strong>
            </li>
          </ul>
        </div>
        
        <div class="cartTable1" id="cartTable">
            <dl>
            <dt>收货人：</dt>
            <dd><input name="name" value="" size="15" class="dizhiInput"/></dd>
          </dl>
          <dl>
            <dt>手机：</dt>
            <dd><input name="mobile" value="" size="20" class="dizhiInput"/></dd>
          </dl>
          <dl>
            <dt>收货区域：</dt>
            <dd>
              <select name="district" id="districtId" class="sgcategory">
              	<option value="">请选择区县</option><option value="南川区(主城)">南川区(主城)</option><option value="南川区(区县)">南川区(区县)</option><option value="北碚区">北碚区</option><option value="巴南区">巴南区</option><option value="璧山县">璧山县</option><option value="长寿区">长寿区</option><option value="城口县">城口县</option><option value="大渡口区">大渡口区</option><option value="大足县">大足县</option><option value="垫江县">垫江县</option><option value="涪陵区">涪陵区</option><option value="丰都县">丰都县</option><option value="奉节县">奉节县</option><option value="合川区">合川区</option><option value="江津区">江津区</option><option value="江北区">江北区</option><option value="九龙坡区">九龙坡区</option><option value="开县">开县</option><option value="梁平县">梁平县</option><option value="南岸区">南岸区</option><option value="彭水">彭水</option><option value="黔江开发区">黔江开发区</option><option value="綦江县">綦江县</option><option value="荣昌县">荣昌县</option><option value="沙坪坝区">沙坪坝区</option><option value="双桥区">双桥区</option><option value="石柱">石柱</option><option value="潼南县">潼南县</option><option value="铜梁县">铜梁县</option><option value="万盛区">万盛区</option><option value="万州区">万州区</option><option value="武隆县">武隆县</option><option value="巫溪县">巫溪县</option><option value="巫山县">巫山县</option><option value="秀山">秀山</option><option value="永川区">永川区</option><option value="渝北区">渝北区</option><option value="渝中区">渝中区</option><option value="云阳县">云阳县</option><option value="酉阳">酉阳</option><option value="忠县">忠县</option>
              </select>
            </dd>
          </dl>
          <dl>
            <dt>详细地址：</dt>
            <dd><input name="address" value="" size="40" class="dizhiInput"></dd>
          </dl>
          <dl>
            <dt>&nbsp;</dt>
            <dd><input value="" type="button" t="add_save" class="dizhiBtn1"></dd>
          </dl>
		</div>
      </td>
	</tr>
    <tr>
      <td bgcolor="#f8f8f8">
        <div class="cartTitle"><strong>购物清单</strong></div>
		        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="ShoppingListTable">
          <tbody><tr>
            <td bgcolor="48b123" width="25" class="ShoppingListL"><div class="ShoppingListLB">聚派商城</div></td>
            <td bgcolor="ffffff" width="908" class="ShoppingListR" valign="top"><div class="ShoppingListBox">
              <table width="100%" border="0" cellspacing="0" cellpadding="0" class="ShoppingListTable1">
                <tbody  id="carts"><tr>
                  <th align="left" width="555" class="tableFirst">商品名称</th>
                  <th align="center" width="64">单价</th>
                  <th align="center" width="170">数量</th>
                  <th align="center" width="104">商品总价</th>
                </tr>
				             

				  </tbody></table>
            </div></td>
          </tr>
        </tbody></table>
                
         <div class="cartTitle"><strong><img style="float:left;cursor:pointer;margin-top:16px" src="image/other/addPage.gif"/>添加代买商品</strong></div>
         
         
         <table width="100%" border="0" cellspacing="0" cellpadding="0" class="ShoppingListTable">
          <tbody><tr>
            <td bgcolor="48b123" width="25" class="ShoppingListL"><div class="ShoppingListLB">代买产品</div></td>
            <td bgcolor="ffffff" width="908" class="ShoppingListR" valign="top"><div class="ShoppingListBox">
              <table width="100%" border="0" cellspacing="0" cellpadding="0" class="ShoppingListTable1">
                <tbody  id="purchasing"><tr>
                  <th align="left" width="555" class="tableFirst">商品名称</th>
                  <th align="center" width="64">单价</th>
                  <th align="center" width="170">数量</th>
                  <th align="center" width="104">商品总价</th>
                </tr>
				  </tbody></table>
            </div></td>
          </tr>
        </tbody></table>
        
      </td>
	</tr>
	<tr>
      <td style="padding-bottom:20px;" bgcolor="#f8f8f8">
        <div class="cartTitle"><strong>备注</strong></div>
        <div class="statistiL" id="order_memo">
			<textarea title="选填：对本次交易的说明（建议填写已经和卖家达成一致的说明）" class="msgtosaler" placeholder="选填：对本次交易的说明（建议填写已经和卖家达成一致的说明）" name="|memo" id="remark" autocomplete="off"></textarea>
        </div>        
      </td>
	</tr>
    <tr>
      <td bgcolor="#f8f8f8" style="border-bottom:4px solid #eeeeee;padding-bottom:20px;">
        <div class="cartTitle"><strong>结算</strong></div>
        
     <!--    <div class="statistiL" id="statistiL">
		          <dl class="off">
            <dt><span></span><strong>使用现金券</strong></dt>
            <dd id="cash_default_box">
            
              
                              <div class="cashCoupon1"><label for="1"><a href="http://www.techan.com/help/317.html" target="_blank">您还没有现金券 (了解规则)</a></label></div>
                            
              <div class="cashCoupon2"><input name="use_cashmanye_no" value="请输入现金券号码" size="20" class="cartInput dd_mod_input_txt cashmanye_no"><input name="use_cashmanye_pwd" type="password" placeholder="请输入现金券密码" value="" size="15" class="cartInput dd_mod_input_txt"><input class="cartBtn" type="button" name="cartCashMoneyBtn" value="激活">
			  </div>            </dd>
          </dl>
          <dl class="off">
            <dt><span></span><strong>使用礼品卡</strong></dt>
            <dd id="gift_default_box">
              <div class="cashCoupon2"><input name="use_gift_no" value="请输入礼品卡号码" size="20" class="cartInput dd_mod_input_txt gift_no"><input name="use_gift_pwd" placeholder="请输入礼品卡密码" value="" type="password" size="15" class="cartInput dd_mod_input_txt"><input name="cartGiftBtn" class="cartBtn" type="button" value="充值"></div>
            </dd>
          </dl>
        </div> -->
        <div class="statistiR">
		  <ul>
		  <input id="postagePrice"  value="0" type="hidden"/>
			<li> <span><font style="color:red" id="total_nums"></font> 件商品，总商品金额：</span> <em id="total_price"></em> </li>
			<li> <span>运费：</span>￥<a id="trans_fee">0.00</a> </li>
			<li> <span>优惠券：</span>-￥<a id="promote_fee" style="color:red">0.00</a> </li>
			<li style="display:none;"> <span>现金券：</span> <em>-￥<a id="cashcard_fee" style="color:red"></a></em> </li>
			<li> <span>应付总额：</span> <em>￥<b id="order_money"></b></em> </li>
		  </ul>
        </div>
        
      </td>
	</tr>
    <tr>
      <td bgcolor="#ffffff" style="padding:8px 22px;" valign="top">
        <div class="Delivery" id="DeliveryTip" style="display:none;"></div>
        <div class="summaryForm" id="useBalance">
          <strong>余额支付</strong>
          <span><input name="Balance" type="checkbox" value="Balance" disabled="disabled"></span>
          <label for="Balance">使用余额（账户当前余额：<em id="currentUserSur">0.00</em>元）</label>
        </div>
        <div class="checkout1">
          <strong>应付总额：￥<b id="order_money2"></b></strong>
          <input type="button" value="" id="btn_order" class="checkoutInput">
        </div>
      </td>
	</tr>
  </tbody></table>
</div>




  <!--#include virtual="footer.html"-->
<script type="text/javascript">
xyzAjax({
	url:"/UserWS/queryAddressList.cus",
	success:function(data){
		if(data.status==1){
			if(data.content.total>0){
				var rows=data.content.rows;
				var html='';
				for(var i=0;i<rows.length;i++){
					if(i==0){
						html+='<li id="'+rows[i].numberCode+'" class="addressBox slt" data-addressDistrict="'+rows[i].addressDistrict+'">';
					}else{
						html+='<li id="'+rows[i].numberCode+'" class="addressBox" data-addressDistrict="'+rows[i].addressDistrict+'">';
					}
					html+=' <input type="radio" name="address" id="userAddr_1" value="18462" class="addressinput">';
					html+='<label>';
					html+='<p><b>'+rows[i].linkName+'</b><em>收</em></p>';
					html+='<p class="listAddressShow">重庆市 重庆 '+rows[i].addressDistrict+' </p>';
					html+='<p class="listAddressShow">'+rows[i].address+'</p>';
					html+='<p class="listAddressShow">'+rows[i].linkPhone+'</p><sub></sub>';
					html+='</label>';
					html+='</li>';
				}
				$("#addressList").prepend(html);
				$(".newSlt").css("display","block");
				$("#cartTable").css("display","none");
				
				//计算邮费
				calculatePostalPrice();
				
			}
		}else{
			top.$.messager.alert("警告",data.msg,"warning");
		}
	}
});


var carts=eval(getCookie("JP_SHOPPING_CART"));
var productCount=0;
var productTotal=0;
if(carts.length>0){
	var count=0;
	var total=0;
	var html='';
	for(var i=0;i<carts.length;i++){
		var perTotal=carts[i].price.toFixed(2)*carts[i].count;
		html+='<tr> ';
		html+='<td align="left" class="tableFirst"><a href=product_detail.html?product="'+carts[i].product+'" title="'+carts[i].productName+'" target="_blank">'+carts[i].productName+'</a></td> ';
		html+='<td align="center">￥'+carts[i].price.toFixed(2)+'元</td>';
		html+='<td align="center">'+carts[i].count+'</td>';
		html+='<td align="center">'+perTotal.toFixed(2)+'</td>';
		html+='</tr> ';
		count+=carts[i].count;
		total+=carts[i].price*carts[i].count;
	}
	$("#carts").append(html);
	$("#total_nums").html(count+"件");
	$("#total_price").html("￥"+total.toFixed(2));
	$("#order_money").html(total.toFixed(2));
	$("#order_money2").html(total.toFixed(2));
	productCount=count;
	productTotal=total;
}



xyzAjax({
	url:"/ProductWS/queryProductList.cus",
	data:{
		page:'1',
		rows:'100',
		type:'4'
	},
	success:function(data){
		if(data.status==1){
			if(data.content.total>0){
				var html='';
				var carts=data.content.rows;
				for(var i=0;i<carts.length;i++){
					var perTotal=carts[i].price.toFixed(2)*carts[i].count;
					html+='<tr data-price="'+carts[i].price+'" data-numbercode="'+carts[i].numberCode+'"> ';
					html+='<td align="left" class="tableFirst"><a>'+carts[i].name+'</a></td> ';
					html+='<td align="center">￥'+carts[i].price.toFixed(2)+'元</td>';
					html+='<td align="center"><select class="select"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option></select></td>';
					html+='<td align="center">0</td>';
					html+='</tr> ';
				}
				$("#purchasing").append(html);
			}
		}else{
			top.$.messager.alert("警告",data.msg,"warning");
		}
	}
});

function calculatePostalPrice(){
	
	var address=$(".slt").data("addressdistrict"); 
	
	if(address=="南川区(主城)"){
		if(productTotal<20){
			$("#postagePrice").val(10);
		}else{
			$("#postagePrice").val(0);
		}
	}else if(address=="南川区(区县)"){
		if(productTotal<200){
			$("#postagePrice").val(20);
		}else{
			$("#postagePrice").val(0);
		}
	}else{
		if(productTotal<40){
			$("#postagePrice").val(25);
		}else{
			$("#postagePrice").val(0);
		}
	}
	
	recalculate();
}


$(".select").change(function(){
	var basePrice=$(this).parents("tr").data("price");
	var count=$(this).val();
	var amount=basePrice*count;
	$(this).parents("tr").children("td:eq(3)").html(amount.toFixed(2));
	
	recalculate();
});

function recalculate(){
	var count=0;
	var total=0;
	var postagePrice=parseFloat($("#postagePrice").val());
	
	$("#purchasing tr").each(function(index){
		if(index>0){
			count+=parseInt($(this).find("select").val());
			total+=$(this).find("select").val()*$(this).data("price");
		}
		
	});
	count+=parseInt(productCount);
	$("#total_nums").html(count);
	$("#trans_fee").html(postagePrice.toFixed(2));
	total+=productTotal;
	$("#total_price").html("￥"+total.toFixed(2));
	total+=postagePrice;
	$("#order_money").html(total.toFixed(2));
	$("#order_money2").html(total.toFixed(2));
	
}





</script>

   
</body>
</html>